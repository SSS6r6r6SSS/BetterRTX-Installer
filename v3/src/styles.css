@import "tailwindcss";
@import "./styles/theme.css";
@import "./styles/ui.css";

@keyframes rainbow-cycle {
  0% {
    fill: oklch(0.901 0.058 230.902);
    border-color: oklch(0.951 0.026 236.824);
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.5),
      0 2px 4px -2px rgba(0, 0, 0, 0.5);
  }
  10% {
    fill: oklch(0.882 0.059 254.128);
    border-color: oklch(0.932 0.032 255.585);
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.75),
      0 2px 4px -2px rgba(0, 0, 0, 0.5);
  }
  20% {
    fill: oklch(0.894 0.057 293.283);
    border-color: oklch(0.943 0.029 294.588);
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.85),
      0 2px 4px -2px rgba(0, 0, 0, 0.5);
  }
  30% {
    fill: oklch(0.892 0.058 10.001);
    border-color: oklch(0.941 0.03 12.58);
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.75),
      0 2px 4px -2px rgba(0, 0, 0, 0.5);
  }
  40% {
    fill: oklch(0.885 0.062 18.334);
    border-color: oklch(0.936 0.032 17.717);
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.65),
      0 2px 4px -2px rgba(0, 0, 0, 0.5);
  }
  50% {
    fill: oklch(0.901 0.076 70.697);
    border-color: oklch(0.954 0.038 75.164);
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.75),
      0 2px 4px -2px rgba(0, 0, 0, 0.5);
  }
  60% {
    fill: oklch(0.924 0.12 95.746);
    border-color: oklch(0.962 0.059 95.617);
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.5),
      0 2px 4px -2px rgba(0, 0, 0, 0.5);
  }
  70% {
    fill: oklch(0.945 0.129 101.54);
    border-color: oklch(0.973 0.071 103.193);
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.65),
      0 2px 4px -2px rgba(0, 0, 0, 0.5);
  }
  80% {
    fill: oklch(0.938 0.127 124.321);
    border-color: oklch(0.967 0.067 122.328);
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.85),
      0 2px 4px -2px rgba(0, 0, 0, 0.85);
  }
  90% {
    fill: oklch(0.905 0.093 164.15);
    border-color: oklch(0.95 0.052 163.051);
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.75),
      0 2px 4px -2px rgba(0, 0, 0, 0.75);
  }
  100% {
    fill: oklch(0.917 0.08 205.041);
    border-color: oklch(0.956 0.045 203.388);
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.5),
      0 2px 4px -2px rgba(0, 0, 0, 0.5);
  }
}

/* Custom utilities - must be at top level, not nested in @layer */
@utility panel { @apply rounded-lg border shadow-sm bg-app-panel border-app-border; }
@utility panel__header { @apply border-b px-4 py-3 border-app-border; }
@utility panel__title { @apply text-base font-semibold; }
@utility panel__body { @apply p-4; }

@utility button {
  @apply btn;
}

@utility button--primary {
  @apply btn;
}

@utility button--ghost { 
  background-color: transparent;
  box-shadow: none;
  &:hover {
    box-shadow: none;
  }
  &:active {
    box-shadow: none;
  }
}

@utility button--danger {
  @apply text-white bg-danger-600 border-danger-700;
  box-shadow: 0 3px 0 0 color-mix(in oklab, var(--color-danger-700) 80%, black 20%);
  &:hover { 
    @apply bg-danger-700;
    transform: translateY(1px);
    box-shadow: 0 2px 0 0 color-mix(in oklab, var(--color-danger-700) 80%, black 20%);
  }
  &:active {
    transform: translateY(3px);
    box-shadow: 0 0 0 0 color-mix(in oklab, var(--color-danger-700) 80%, black 20%);
  }
}

@utility badge { @apply inline-flex items-center rounded-md border px-2 py-0.5 text-xs font-semibold border-app-border; }

@utility hover-lift {
  @apply transition-transform;
  &:hover { transform: translateY(-1px); }
}

/* Tailwind layers + BEM-style component classes for the installer UI */
@layer base {
  html,
  body,
  #root {
    @apply h-full;
  }

  body {
    @apply antialiased font-sans bg-app-bg text-app-fg scrollbar;
  }

}

@layer components {
  /* App shell */
  .app {
    @apply grid min-h-screen;
    grid-template-rows: 3rem 1fr;
  }

  .app__header {
    @apply sticky top-0 z-40 flex items-center gap-3 border-b px-4 border-app-border;
    background-color: color-mix(in oklab, var(--color-app-bg) 85%, black 15%);
  }

  .app__brand {
    @apply text-sm font-semibold tracking-wide;
  }

  .app__badge {
    @apply inline-flex items-center rounded px-2 py-0.5 text-xs font-semibold border border-app-border bg-success-600 text-white;
  }

  .app__body {
    @apply grid;
    grid-template-columns: 16rem 1fr;
  }

  .app__sidebar {
    @apply hidden md:flex md:flex-col gap-1 border-r p-4 bg-app-panel border-app-border;
  }

  .app__content {
    @apply p-4 md:p-6;
  }

  /* Sidebar navigation */
  .nav { @apply flex flex-col gap-1; }

  .nav__link {
    @apply w-full text-left rounded-md px-3 py-2 text-sm border transition-colors text-app-fg border-transparent bg-app-panel/95;
  }

  .nav__link:hover {
    @apply border-app-border bg-app-panel/90;
  }

  .nav__link--active {
    @apply border-brand-accent bg-brand-accent/20;
  }

  /* Panels / cards - utilities moved to top level */

  /* Sections */
  .section { @apply space-y-2; }
  .section__title { @apply text-xs font-semibold uppercase tracking-wider text-app-muted; }
  .divider { @apply my-4 h-px w-full bg-app-border; }

  /* Buttons - utilities moved to top level */

  /* Form controls */
  .field { @apply grid gap-1; }
  .field__label { @apply text-xs font-medium text-app-muted; }
  .field__control { @apply relative; }
  .field__input { @apply w-full rounded-md border bg-transparent px-3 py-2 text-sm outline-none focus:ring-2 border-app-border text-app-fg; }
  .field__input:focus { @apply ring-brand-accent border-brand-accent; }

  /* Badges - utilities moved to top level */
  .badge--on { @apply text-black bg-minecraft-green-300 border-minecraft-green-400; }
}

@layer components {
  /* Top toolbar */
  .top-toolbar {
    @apply sticky top-0 z-50 flex h-12 items-center justify-between border-b px-3 md:px-4 border-app-border;
    background-color: color-mix(in oklab, var(--color-app-bg) 85%, black 15%);
  }
  .app-title { @apply text-sm md:text-base font-semibold; }
    .nav-tabs {
    @apply flex border-2 border-minecraft-slate-800 bg-minecraft-slate-900 rounded-sm;
  }

    .nav-btn {
    @apply flex-1 py-1.5 px-4 text-center cursor-pointer bg-minecraft-slate-600 text-white/80 border-2 border-transparent -m-px font-semibold uppercase tracking-wider text-xs;
  }

    .nav-btn:hover {
    @apply bg-minecraft-slate-500 text-white;
  }

  .nav-btn.active {
    @apply bg-minecraft-slate-500 text-white border-b-2 border-b-white/90;
  }
  .toolbar-icon-btn { @apply grid h-8 w-8 place-items-center rounded-md border text-sm border-app-border; }

  /* Layout */
  .app-layout { @apply relative; }
  .main-content { @apply mx-auto max-w-7xl p-4 md:p-6; }
  .app-header h1 { @apply text-xl font-semibold; }
  .app-header p { @apply text-sm; }

  /* Slideout sidepanel (mobile) */
  .mobile-menu-toggle { @apply md:hidden absolute left-3 top-14 z-40 grid h-10 w-10 place-items-center rounded-md border border-app-border bg-app-panel; }
  .mobile-menu-toggle > span { @apply block h-0.5 w-5 rounded bg-app-fg; }
  .mobile-menu-toggle > span + span { @apply mt-1; }

  .actions-sidepanel {
    @apply fixed left-0 top-0 z-50 h-full w-72 -translate-x-full transform border-r p-4 transition-transform md:hidden bg-app-panel border-app-border;
  }
  .actions-sidepanel.open { @apply translate-x-0; }
  .sidepanel-header { @apply mb-3 flex items-center justify-between; }
  .sidepanel-content { @apply overflow-y-auto; }
  .sidepanel-overlay { @apply fixed inset-0 z-40 hidden bg-black/50 md:hidden; }
  .sidepanel-overlay.visible { @apply block; }

  /* Desktop/Mobile visibility helpers */
  .desktop-only { @apply hidden md:block; }
  .mobile-only { @apply md:hidden; }

  /* Section toolbars */
  .section-toolbar { @apply mb-3 flex items-center justify-between; }
  .toolbar-title { @apply flex items-center gap-2; }
  .toolbar-title h2 { @apply text-lg font-semibold; }
  .item-count { @apply text-xs text-muted; }
  .toolbar-actions { @apply flex items-center gap-2; }
  .toolbar-btn { @apply button; }

  /* Actions */
  .actions-list { @apply grid gap-2; }
  .actions-grid { @apply grid gap-2 sm:grid-cols-2 lg:grid-cols-3; }
  .action-btn { @apply button; }
  .action-btn.danger { @apply button--danger; }

  /* Installations grid/cards */
  .installations-grid { @apply grid gap-3 md:grid-cols-2 lg:grid-cols-3; }
  .installation-card { @apply panel cursor-pointer; }
  .installation-card.selected { @apply border-brand-accent; outline: 2px solid color-mix(in oklab, var(--color-brand-accent) 35%, transparent); }
  .installation-header { @apply flex items-center justify-between border-b px-4 py-3 border-app-border; }
  .installation-title { @apply flex items-center gap-2; }
  .installation-title h3 { @apply text-sm font-semibold; }
  .installation-checkbox { @apply cursor-pointer accent-brand-accent bg-minecraft-slate-500 border-minecraft-slate-800 appearance-none rounded-xs; }
  .preset-icon { @apply size-6 sm:size-12 rounded-sm object-cover; }
  .preview-badge { @apply badge bg-brand-accent-600 text-white; border-color: color-mix(in oklab, var(--color-brand-accent-600) 70%, black 30%); }
  .installation-path { @apply px-4 pt-2 text-xs text-app-muted break-all font-mono select-all; }
  .installed-preset-info, .no-preset-info { @apply px-4 text-xs; }
  .no-preset-info { @apply text-app-muted; }
  .installation-actions { @apply panel__body flex items-center gap-2; }
  .checkbox-label { @apply text-xs text-app-muted; }

  /* Presets */
  .presets-grid { @apply flex flex-col max-w-full gap-4; }
  .presets-list {
    @apply grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4;
  }
  .preset-card {
    @apply panel flex flex-col cursor-pointer contain-layout transition-all duration-200 rounded-lg border p-4 hover:shadow-lg;
  }

  .preset-card.selected { @apply border-brand-accent; }
  .preset-header { @apply flex items-center gap-3 border-b px-4 py-3 border-app-border; }
  .preset-link { @apply hover:underline cursor-pointer; }
  .preset-stub-container {
    @apply w-full overflow-hidden relative max-w-full h-10;
    scrollbar-gutter: stable;
  }
  .preset-stub-container:hover {
    @apply overflow-x-auto;
  }
  .preset-stub-link { 
    @apply hover:underline cursor-pointer font-mono text-xs whitespace-nowrap block transition-all duration-200;
  }
  .preset-stub-container:not(:hover) .preset-stub-link {
    @apply overflow-hidden max-w-full text-ellipsis;
  }

  .preset-details {
    @apply flex flex-col gap-3;
  }

  .install-preset-btn { @apply m-4 button button--primary; }

  /* Empty state */
  .empty-state { @apply panel p-6 text-center text-sm text-app-muted; }

  /* Drag & drop */
  .drop-zone { @apply my-6 grid h-28 place-items-center rounded-md border-2 border-dashed border-app-border bg-app-panel/90; }
  .drop-zone.drag-over { @apply border-brand-accent bg-brand-accent/10; }

  /* Status & progress */
  .status { @apply text-sm; }
  .status.error { @apply text-danger-600; }
  .progress-container { @apply mt-2 h-2 w-full overflow-hidden rounded bg-black/30; }
  .progress-bar { @apply h-full w-1/2 bg-brand-accent-600; }

  /* Console */
  .console-header { @apply mt-6 flex cursor-pointer items-center justify-between border px-4 py-2 border-app-border bg-app-panel; }
  .console-panel { @apply overflow-hidden rounded-b-md border border-app-border bg-app-panel; max-height: 18rem; transition: max-height .2s ease; }
  .console-panel.collapsed { max-height: 0; border-top-width: 0; }
  .console-panel.expanded { max-height: 18rem; }
  .console-output { @apply h-56 whitespace-pre-wrap overflow-auto p-3 text-xs font-mono; }
  .console-clear-btn { @apply m-2 self-end button; }

  /* Toolbar menu button */
  .toolbar-menu-btn { @apply button button--ghost p-2; }
  
  /* Popovers */
  .settings-popover, .help-popover { @apply rounded-md border shadow-lg border-app-border bg-app-panel text-app-fg; }
  
  .toolbar-popover { 
    @apply rounded-md border shadow-lg border-app-border bg-app-panel text-app-fg fixed top-16 right-1 z-1000 min-w-80;
  }
  .popover-header { @apply flex items-center justify-between border-b px-4 py-2 border-app-border; }
  .popover-content { @apply p-4 space-y-4; }
  .setting-group > label { @apply block text-xs font-semibold text-muted mb-1; }
  .setting-buttons { @apply flex flex-wrap gap-2; }
  .setting-btn { @apply button; }
  .setting-btn.danger { @apply button--danger; }

  .status-alert {
    @apply fixed right-2 bottom-14 z-40 flex items-center gap-3 px-4 py-3 rounded-lg border shadow-lg cursor-pointer select-none;
  }

  /* Console Panel Component */
  .console-container {
    @apply flex flex-col overflow-hidden relative;
  }
  
  .console-output {
    @apply font-mono;
    font-feature-settings: "liga" 0, "calt" 0;
  }

  .console-clear-btn {
    @apply font-sans;
  }

  .console-panel--expanded { @apply max-h-80; }
  .console-panel--collapsed { @apply max-h-0 rounded-b-xl; }

  body:has(.console-panel--expanded) {
    @apply overflow-hidden h-screen;
  }

  body:has(.console-panel--expanded) .status-alert {
    @apply bottom-80;
  }

  /* Switch Component */
  .switch {
    @apply grid grid-flow-row grid-cols-3;
  }

  .switch:hover .switch__track .switch__button {
    @apply rounded-md bg-minecraft-slate-300/50;
  }

  .switch:hover .switch__track[data-checked] .switch__button {
    @apply bg-minecraft-slate-200;
  }

  .switch:hover .switch__handle {
    @apply border-x-minecraft-slate-700 border-b-minecraft-slate-800;
  }

  .switch:hover .switch__track[data-checked] {
    @apply border-minecraft-green-100 bg-minecraft-green-200;
  }

  .switch__label {
    @apply cursor-pointer select-none text-lg font-medium text-minecraft-slate-100 col-span-2;
  }

  .switch__description {
    @apply cursor-default select-none text-sm text-minecraft-slate-300 col-span-2;
  }

  .switch__handle {
    @apply -mt-2 flex size-12 -translate-x-1 items-stretch rounded-md border border-b-4 border-minecraft-slate-400 border-b-minecraft-slate-600 bg-minecraft-slate-200 shadow-md outline-1 outline-minecraft-slate-900/50 transition duration-300 ease-out group-data-checked:translate-x-12 cursor-pointer;
  }

  .switch:hover .switch__handle {
    @apply border-x-minecraft-slate-700 border-b-minecraft-slate-800 cursor-pointer;
  }

  .switch__button {
    @apply h-full w-full rounded-sm border-2 border-minecraft-slate-50/75 pt-4 transition duration-200 ease-out cursor-pointer;
  }

  .switch:hover .switch__track .switch__button {
    @apply rounded-md bg-minecraft-slate-300/50;
  }

  .switch:hover .switch__track[data-checked] .switch__button {
    @apply bg-minecraft-slate-200;
  }

  .switch__track {
    @apply relative row-span-2 mt-2 inline-flex h-10 w-24 items-center place-self-center justify-self-end rounded-sm border-2 border-minecraft-slate-900/60 bg-minecraft-slate-300 shadow-xs outline-1 outline-black/50 transition data-checked:border-minecraft-green-200 data-checked:bg-minecraft-green-300 cursor-pointer;
  }

  .switch:hover .switch__track .switch__button {
    @apply rounded-md bg-minecraft-slate-300/50;
  }

  .switch:hover .switch__track[data-checked] .switch__button {
    @apply bg-minecraft-slate-200;
  }

  .switch:hover .switch__track[data-checked] {
    @apply border-minecraft-green-100 bg-minecraft-green-200;
  }

  .switch__track-background {
    @apply absolute flex h-full w-1/2 select-none items-center justify-center text-white/75 opacity-0 transition-opacity group-data-checked:opacity-100;
  }

  .switch__track-background + .switch__track-background {
    @apply right-0 rounded-r border-2 border-l-0 border-minecraft-slate-200/30 text-minecraft-slate-900/50 opacity-100 group-data-checked:opacity-0;
  }
}