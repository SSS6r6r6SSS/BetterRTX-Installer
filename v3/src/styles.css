@import "tailwindcss";
@import "./theme.css";

/* Custom utilities - must be at top level, not nested in @layer */
@utility panel { @apply rounded-lg border shadow-sm bg-app-panel border-app-border; }
@utility panel__header { @apply border-b px-4 py-3 border-app-border; }
@utility panel__title { @apply text-base font-semibold; }
@utility panel__body { @apply p-4; }

@utility button {
  @apply inline-flex items-center justify-center gap-2 rounded-md border-2 px-4 py-2 text-sm font-medium transition-all select-none disabled:pointer-events-none disabled:opacity-50 cursor-pointer;
  @apply text-app-fg border-app-border bg-app-panel/95;
  box-shadow: 0 3px 0 0 color-mix(in oklab, var(--color-app-border) 80%, black 20%);
  transform: translateY(0);
  &:hover { 
    @apply bg-app-panel/90;
    transform: translateY(1px);
    box-shadow: 0 2px 0 0 color-mix(in oklab, var(--color-app-border) 80%, black 20%);
  }
  &:active {
    transform: translateY(3px);
    box-shadow: 0 0 0 0 color-mix(in oklab, var(--color-app-border) 80%, black 20%);
  }
}

@utility button--primary {
  @apply text-white bg-brand-accent-600 border-brand-accent;
  box-shadow: 0 3px 0 0 color-mix(in oklab, var(--color-brand-accent-600) 80%, black 20%);
  &:hover { 
    @apply bg-brand-accent;
    transform: translateY(1px);
    box-shadow: 0 2px 0 0 color-mix(in oklab, var(--color-brand-accent-600) 80%, black 20%);
  }
  &:active {
    transform: translateY(3px);
    box-shadow: 0 0 0 0 color-mix(in oklab, var(--color-brand-accent-600) 80%, black 20%);
  }
}

@utility button--ghost { 
  background-color: transparent;
  box-shadow: none;
  &:hover {
    box-shadow: none;
  }
  &:active {
    box-shadow: none;
  }
}

@utility button--danger {
  @apply text-white bg-danger-600 border-danger-700;
  box-shadow: 0 3px 0 0 color-mix(in oklab, var(--color-danger-700) 80%, black 20%);
  &:hover { 
    @apply bg-danger-700;
    transform: translateY(1px);
    box-shadow: 0 2px 0 0 color-mix(in oklab, var(--color-danger-700) 80%, black 20%);
  }
  &:active {
    transform: translateY(3px);
    box-shadow: 0 0 0 0 color-mix(in oklab, var(--color-danger-700) 80%, black 20%);
  }
}

@utility badge { @apply inline-flex items-center rounded-md border px-2 py-0.5 text-xs font-semibold border-app-border; }

@utility hover-lift {
  @apply transition-transform;
  &:hover { transform: translateY(-1px); }
}

/* Tailwind layers + BEM-style component classes for the installer UI */
@layer base {
  html,
  body,
  #root {
    @apply h-full;
  }

  body {
    @apply antialiased font-sans bg-app-bg text-app-fg;
  }

}

@layer components {
  /* App shell */
  .app {
    @apply grid min-h-screen;
    grid-template-rows: 3rem 1fr;
  }

  .app__header {
    @apply sticky top-0 z-40 flex items-center gap-3 border-b px-4 border-app-border;
    background-color: color-mix(in oklab, var(--color-app-bg) 85%, black 15%);
  }

  .app__brand {
    @apply text-sm font-semibold tracking-wide;
  }

  .app__badge {
    @apply inline-flex items-center rounded px-2 py-0.5 text-xs font-semibold border border-app-border bg-success-600 text-white;
  }

  .app__body {
    @apply grid;
    grid-template-columns: 16rem 1fr;
  }

  .app__sidebar {
    @apply hidden md:flex md:flex-col gap-1 border-r p-4 bg-app-panel border-app-border;
  }

  .app__content {
    @apply p-4 md:p-6;
  }

  /* Sidebar navigation */
  .nav { @apply flex flex-col gap-1; }

  .nav__link {
    @apply w-full text-left rounded-md px-3 py-2 text-sm border transition-colors text-app-fg border-transparent bg-app-panel/95;
  }

  .nav__link:hover {
    @apply border-app-border bg-app-panel/90;
  }

  .nav__link--active {
    @apply border-brand-accent bg-brand-accent/20;
    outline: 2px solid color-mix(in oklab, var(--color-brand-accent) 35%, transparent);
  }

  /* Panels / cards - utilities moved to top level */

  /* Sections */
  .section { @apply space-y-2; }
  .section__title { @apply text-xs font-semibold uppercase tracking-wider text-app-muted; }
  .divider { @apply my-4 h-px w-full bg-app-border; }

  /* Buttons - utilities moved to top level */

  /* Form controls */
  .field { @apply grid gap-1; }
  .field__label { @apply text-xs font-medium text-app-muted; }
  .field__control { @apply relative; }
  .field__input { @apply w-full rounded-md border bg-transparent px-3 py-2 text-sm outline-none focus:ring-2 border-app-border text-app-fg; }
  .field__input:focus { @apply ring-brand-accent border-brand-accent; }

  /* Badges - utilities moved to top level */
  .badge--on { @apply text-black bg-minecraft-green-300 border-minecraft-green-400; }
}

@layer components {
  /* Top toolbar */
  .top-toolbar {
    @apply sticky top-0 z-50 flex h-12 items-center justify-between border-b px-3 md:px-4 border-app-border;
    background-color: color-mix(in oklab, var(--color-app-bg) 85%, black 15%);
  }
  .app-title { @apply text-sm md:text-base font-semibold; }
  .toolbar-nav { @apply flex items-center gap-1; }
  .nav-btn {
    @apply rounded-md border px-3 py-1.5 text-xs md:text-sm font-medium transition-colors text-app-fg border-transparent bg-app-panel/95;
  }
  .nav-btn:hover { @apply border-app-border bg-app-panel/90; }
  .nav-btn.active { @apply border-brand-accent bg-brand-accent/20; outline: 2px solid color-mix(in oklab, var(--color-brand-accent) 35%, transparent); }
  .toolbar-icon-btn { @apply grid h-8 w-8 place-items-center rounded-md border text-sm border-app-border; }

  /* Layout */
  .app-layout { @apply relative; }
  .main-content { @apply mx-auto max-w-7xl p-4 md:p-6; }
  .app-header h1 { @apply text-xl font-semibold; }
  .app-header p { @apply text-sm; }

  /* Slideout sidepanel (mobile) */
  .mobile-menu-toggle { @apply md:hidden absolute left-3 top-14 z-40 grid h-10 w-10 place-items-center rounded-md border border-app-border bg-app-panel; }
  .mobile-menu-toggle > span { @apply block h-0.5 w-5 rounded bg-app-fg; }
  .mobile-menu-toggle > span + span { @apply mt-1; }

  .actions-sidepanel {
    @apply fixed left-0 top-0 z-50 h-full w-72 -translate-x-full transform border-r p-4 transition-transform md:hidden bg-app-panel border-app-border;
  }
  .actions-sidepanel.open { @apply translate-x-0; }
  .sidepanel-header { @apply mb-3 flex items-center justify-between; }
  .sidepanel-content { @apply overflow-y-auto; }
  .sidepanel-overlay { @apply fixed inset-0 z-40 hidden bg-black/50 md:hidden; }
  .sidepanel-overlay.visible { @apply block; }

  /* Desktop/Mobile visibility helpers */
  .desktop-only { @apply hidden md:block; }
  .mobile-only { @apply md:hidden; }

  /* Section toolbars */
  .section-toolbar { @apply mb-3 flex items-center justify-between; }
  .toolbar-title { @apply flex items-center gap-2; }
  .toolbar-title h2 { @apply text-lg font-semibold; }
  .item-count { @apply text-xs text-muted; }
  .toolbar-actions { @apply flex items-center gap-2; }
  .toolbar-btn { @apply button; }

  /* Actions */
  .actions-list { @apply grid gap-2; }
  .actions-grid { @apply grid gap-2 sm:grid-cols-2 lg:grid-cols-3; }
  .action-btn { @apply button; }
  .action-btn.danger { @apply button--danger; }

  /* Installations grid/cards */
  .installations-grid { @apply grid gap-3 md:grid-cols-2 lg:grid-cols-3; }
  .installation-card { @apply panel hover-lift; }
  .installation-card.selected { @apply border-brand-accent; outline: 2px solid color-mix(in oklab, var(--color-brand-accent) 35%, transparent); }
  .installation-header { @apply flex items-center justify-between border-b px-4 py-3 border-app-border; }
  .installation-title { @apply flex items-center gap-2; }
  .installation-title h3 { @apply text-sm font-semibold; }
  .preset-icon { @apply size-6 rounded-sm object-cover; }
  .preview-badge { @apply badge bg-brand-accent-600 text-white; border-color: color-mix(in oklab, var(--color-brand-accent-600) 70%, black 30%); }
  .installation-path { @apply px-4 pt-2 text-xs text-app-muted break-all font-mono select-all; }
  .installed-preset-info, .no-preset-info { @apply px-4 text-xs; }
  .no-preset-info { @apply text-app-muted; }
  .installation-actions { @apply panel__body flex items-center gap-2; }
  .checkbox-label { @apply text-xs text-app-muted; }

  /* Presets */
  .presets-grid { @apply grid gap-3 sm:grid-cols-2 lg:grid-cols-3; }
  .preset-card { @apply panel hover-lift cursor-pointer; }
  .preset-card.selected { @apply border-brand-accent; outline: 2px solid color-mix(in oklab, var(--color-brand-accent) 35%, transparent); }
  .preset-header { @apply flex items-center gap-3 border-b px-4 py-3 border-app-border; }
  .install-preset-btn { @apply m-4 button button--primary; }

  /* Empty state */
  .empty-state { @apply panel p-6 text-center text-sm text-app-muted; }

  /* Drag & drop */
  .drop-zone { @apply my-6 grid h-28 place-items-center rounded-md border-2 border-dashed border-app-border bg-app-panel/90; }
  .drop-zone.drag-over { @apply border-brand-accent bg-brand-accent/10; }

  /* Status & progress */
  .status { @apply text-sm; }
  .status.error { @apply text-danger-600; }
  .progress-container { @apply mt-2 h-2 w-full overflow-hidden rounded bg-black/30; }
  .progress-bar { @apply h-full w-1/2 bg-brand-accent-600; }

  /* Console */
  .console-header { @apply mt-6 flex cursor-pointer items-center justify-between border px-4 py-2 border-app-border bg-app-panel; }
  .console-panel { @apply overflow-hidden rounded-b-md border border-app-border bg-app-panel; max-height: 18rem; transition: max-height .2s ease; }
  .console-panel.collapsed { max-height: 0; border-top-width: 0; }
  .console-panel.expanded { max-height: 18rem; }
  .console-output { @apply h-56 whitespace-pre-wrap overflow-auto p-3 text-xs font-mono; }
  .console-clear-btn { @apply m-2 self-end button; }

  /* Toolbar menu button */
  .toolbar-menu-btn { @apply button button--ghost p-2; }
  
  /* Popovers */
  .settings-popover, .help-popover { @apply rounded-md border shadow-lg border-app-border bg-app-panel text-app-fg; }
  
  .toolbar-popover { 
    @apply rounded-md border shadow-lg border-app-border bg-app-panel text-app-fg fixed top-16 right-1 z-1000 min-w-80;
  }
  .popover-header { @apply flex items-center justify-between border-b px-4 py-2 border-app-border; }
  .popover-content { @apply p-4 space-y-4; }
  .setting-group > label { @apply block text-xs font-semibold text-muted mb-1; }
  .setting-buttons { @apply flex flex-wrap gap-2; }
  .setting-btn { @apply button; }
  .setting-btn.danger { @apply button--danger; }

  .status-alert {
    @apply fixed right-2 bottom-14 z-40 flex items-center gap-3 px-4 py-3 rounded-lg border shadow-lg cursor-pointer select-none;
  }

  /* Console Panel Component */
  .console-container {
    @apply flex flex-col overflow-hidden relative;
  }
  
  .console-output {
    @apply font-mono;
    font-feature-settings: "liga" 0, "calt" 0;
  }

  .console-clear-btn {
    @apply font-sans;
  }

  .console-panel--expanded { @apply max-h-80; }
  .console-panel--collapsed { @apply max-h-0; }

  body:has(.console-panel--expanded) {
    @apply overflow-hidden h-screen;
  }

  body:has(.console-panel--expanded) .status-alert {
    @apply bottom-80;
  }
}